
# ALPHA PROJECT
<div>
    <p align="center">
      <img src="test_img/alpha.png" width="500" height="310">
    </p>
    <p align="center">
        <em>.paint by dall-e-2</em>
    </p> 
    <p align="center">
        <strong>GitHub Repository</strong> <br>
        <a href="https://github.com/sangrokjung/alpha_male_Front"><strong> Mobile GitHub Repo</strong></a> · 
        <a href="https://github.com/sangrokjung/alpha_male_dl_server"><strong> DL Server GitHub Repo</strong></a>
    </p>
</div>

<br>

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li><a href="#about-project">About Project</a>
    <li><a href="#tech-used">Tech Used</a>
    <li><a href="#project-team">Project Team</a></li>
    <li><a href="#user-stories">User Stories</a></li>
    <li><a href="#survey">Survey</a></li>
    <li><a href="#back-end-server">Back-End Server</a></li>
    <li><a href="#dl-server">DL Server</a></li>
    <li><a href="#data-base">Data Base</a></li>
    <li><a href="#dl">DL</a></li>
    <li><a href="#mobile">Mobile</a></li>
  </ol>
</details>

<br>

<!-- ABOUT PROJECT -->
## About Project

<div>
    <p align="center">
        <img src="test_img/v1.png" width="200" height="410">
        <img src="test_img/alpha_result_v3.png" width="200" height="410">
    </p>
    <p align="center">
        <img src="test_img/Client_diagrm.PNG" width="600" height="400">
    </p>
</div>

## BMC
### KEY ACTIVITES
> **DL을 활용한 남성 얼굴 유형 분류.** <br>
> **사용자가 속한 유형별 남성 이미지 제공.**

### KEY RESOURCES
> **설문을 통한 분류한 남성 유명인 얼굴 유형 이미지 데이터.** <br>

### VALUE PROPOSITION
> **자신의 외모 유형이 궁금한 사람들을 AI를 통해 궁금증을 해소 할 수 있게 도와준다.** <br>
> **사용자는 AlphaMale을 통해 자신의 얼굴이 어떤 유형에 속하는지 알 수 있고 주변 지인들과 결과를 공유, 비교하며 즐거움을 얻을 수 있을 것이다.**

### CHANNELS
> **Application : "AlphaMale"** <br>

### CUSTOMER SEGEMENTS
> **자신 또는 타인의 외모 유형이 궁금한 사람** <br>

### 추진 방향
> **대한민국 20~30대 성인 남녀 100여명의 설문조사를 통해 얻은 데이터를 바탕으로 대한민국 남자 유명인 110명의 얼굴 유형을 분류.**<br>
> **설문조사를 통해 분류된 유명인의 얼굴을 3분할(얼굴 전체, T-Zone, 하관)하여 FPN이 도입된 Faster RCNN 방식의 multi object detection model 학습.**<br>
> **학습이 완료된 model을 통해 사용자의 얼굴 유형을 분석 후 결과 제공.**


<!-- TECH USED -->
## TECH Used

### MOBILE
<p align="left">
    <img src="https://img.shields.io/badge/androidstudio-000000?style=for-the-badge&logo=androidstudio">
    <img src="https://img.shields.io/badge/dart-000000?style=for-the-badge&logo=dart&logoColor=54ABE3">
    <img src="https://img.shields.io/badge/flutter-000000?style=for-the-badge&logo=flutter&logoColor=6DBDEB">
    <img src="https://img.shields.io/badge/github-000000?style=for-the-badge&logo=github">
</p>

### BACK-END
<p align="left">
    <img src="https://img.shields.io/badge/pycharm-000000?style=for-the-badge&logo=pycharm">
    <img src="https://img.shields.io/badge/python-000000?style=for-the-badge&logo=python">
    <img src="https://img.shields.io/badge/fastapi-000000?style=for-the-badge&logo=fastapi">
    <img src="https://img.shields.io/badge/postqresql-000000?style=for-the-badge&logo=postgresql">
    <img src="https://img.shields.io/badge/githubactions-000000?style=for-the-badge&logo=githubactions">
    <img src="https://img.shields.io/badge/docker-000000?style=for-the-badge&logo=docker">
    <img src="https://img.shields.io/badge/github-000000?style=for-the-badge&logo=github">
</p>

### CLOUD
<p align="left">
    <img src="https://img.shields.io/badge/EC2-Amazon-000000?style=for-the-badge&logo=amazonec2">
    <img src="https://img.shields.io/badge/RDS-Amazon-000000?style=for-the-badge&logo=amazonrds">
    <img src="https://img.shields.io/badge/ECS-Amazon-000000?style=for-the-badge&logo=amazonecs">
    <img src="https://img.shields.io/badge/S3-Amazon-000000?style=for-the-badge&logo=amazons3">
</p>

### DL/ML
<p align="left">
    <img src="https://img.shields.io/badge/jupyter-000000?style=for-the-badge&logo=jupyter">
    <img src="https://img.shields.io/badge/python-000000?style=for-the-badge&logo=python">
    <img src="https://img.shields.io/badge/Pytorch-000000?style=for-the-badge&logo=pytorch">
    <img src="https://img.shields.io/badge/numpy-000000?style=for-the-badge&logo=numpy&logoColor=5174C3">
    <img src="https://img.shields.io/badge/pandas-000000?style=for-the-badge&logo=pandas&logoColor=A0BCDF">
    <img src="https://img.shields.io/badge/opencv-000000?style=for-the-badge&logo=opencv">
    </p><img src="https://img.shields.io/badge/github-000000?style=for-the-badge&logo=github">




<!-- PROJECT TEAM -->
## Project Team



**SangRok Jung** : <a href="https://github.com/sangrokjung" target="_blank">github</a> - sesilao@naver.com
> * Lead
>   * Project Lead.
>   * Managing GitHub Repositories and Policies.
>   * Notion, Upbase Management.
>   * Manage schedules.
>   * Planning and production of readme.
> * Back-End
>   * Imaging DL Servers with Dockers
>   * Leverage FastAPI to create POST Protocols for the Client to send.
>   * Create an API to call DL.
>   * Create an API that stores data sent by the Client in DB.
>   * Connect with DataBase.
> * Cloud
>   * Building an EC2 Ubuntu environment for DL learning. (G4dn, P4)
>   * Deploying DL Server CICD with GitHub Actions and S3, EC2.
>   * Deploying Back-End Server CICD with GitHub Actions and ECR, ECS, and ELB.
>   * Deploying RDBMS PostgreSQL using RDS.
> * DataBase.
>   *  Schema, table, and data CRUD utilizing PostgreSQL.
>   *  ERD Production.
> * Mobile
>   * Design with Mockup.
> * DL/ML
>   * Collection of data through crawling.




**Seungwon Lee** : <a href="https://github.com/diet-teacher" target="_blank">github</a> - lsw4556@daum.net
> * DL/ML
>   * Collection of data through crawling.
>   * Analyse surveyed data and visualized it using matplotlib and pandas
>   * Trained the first DL model to find out human face is exist using Pytorch
>   * Trained the second DL model that for auto labeling using Pytorch
>   * Trained the third DL model to detect three parts of faces and classify there class using Pytorch

**Jaehee Han** : <a href="https://github.com/82Hardy-J" target="_blank">github</a> - handjh6903@naver.com
> * Team work
>   * Execute Leader's Command, Compliance with project rules.
> * Mobile
>   * Camera function and album function were activated using Image Picker.
>   * It makes a request to the server using HTTP and Post and responds with information.
>   * Parse the data received as a response using HTTP and put
>   * Give the user MainPage, SelectPage,Show the ResultPage.
>   * Create the features required for each page.
>   * Designed the app logo.
> * DL/ML
>   * Collection of data through crawling.
>   * Model Testing.

<!-- USER STORIES -->
## User Stories
> Epics
> * 메인 (뷰)
>     * 카메라 버튼
>     * 갤러리 버튼
> * 이미지 입력 (뷰)
>     * 카메라
>         * 카메라 촬영 버튼
>     * 갤러리
>         * 갤러리 사진 선택
> * 이미지 로드 (뷰)
>     * 카메라 촬영 결과 or 갤러리에서 선택 된 이미지
>     * MBTI 인풋(메뉴 리스트)
>     * 생년월일 인풋(calendar)
>     * 분석 버튼 (비활성 : 회색, 활성 : 유색)
>     * 뒤로 가기 버튼
> * 결과(뷰)
>     * 홈 버튼
>     * 공유하기 버튼
>     * 이미지 저장 버튼
> 
> 
> 
> Stories
> * 메인(뷰)
>     * 사용자 스토리
>         * 사용자는 알파메일의 메인뷰에 진입한다.
>         * 사용자는 카메라 버튼을 클릭한다.
>         * 사용자는 갤러리 버튼은 클릭한다.
>     * 시스템 스토리
>         * 시스템(클라이언트)은 휴대폰 카메라에 연결한다.
>         * 시스템(클라이언트)은 휴대폰 카메라에 연결한다.
>         * 시스템(클라이언트)은 휴대폰 갤러리의 사진을 불러온다.
> * 이미지 입력 (뷰)
>     * 사용자 스토리
>         * 카메라
>             * 사용자는 카메라 촬영 버튼을 누른다.
>             * 사용자는 뒤로 가기 버튼을 누른다.
>                 * 사용자는 메인 뷰로 돌아간다.
>         * 갤러리
>             * 사용자는 사진을 선택한다.
>             * 사용자는 뒤로 가기 버튼을 누른다.
>                 * 사용자는 메인 뷰로 돌아간다.
>     * 시스템 스토리
>         * 시스템(클라이언트)은 사용자가 뒤로 가기 선택시 메인 뷰로 돌아간다.
> * 이미지 로드 (뷰)
>     * 사용자 스토리
>         * 사용자는 자신의 이미지를 확인한다.
>         * 사용자는 MBTI와 생년월일을 입력하지 않고 분석 버튼을 누른다.
>             * 사용자는 알림창을 본다.
>             * 사용자는 알림창을 터치하고 다시 데이터를 입력한다.
>         * 사용자는 MBTI를 입력한다.
>         * 사용자는 생년월일을 입력한다.
>         * 사용자는 분석 버튼을 누른다.
>     * 시스템 스토리
>         * 시스템(클라이언트)은 사용자가 생년월일과 MBTI를 입력하지 않고 분석 버튼을 누를시 아무일도 발생시키지 않는다.
>         * 시스템(클라이언트)은 사용자가 생년월일과 MBTI를 입력하고 분석 버튼을 누르면 사용자에게 로딩중 화면을 출력한다.
>         * 시스템(클라이언트)은 사용자의 이미지를 base64 string type 변환하고 생년월일과 MBTI 데이터를 시스템(백엔드 서버)로 POST한다.
>             * 시스템(벡엔드 서버)는 DL_model1을 통해 이미지에 사람 얼굴이 존재하는지 validation 한다.
>                 * 시스템(벡엔드 서버)는 얼굴이 존재하지 않으면 시스템(클라이언트)에 에러를 response한다.
>                     * 시스템(클라이언트)은 0을 response 받으면 “위와 같은 구도의 사진을 선택해 주세요.”라는 text와 사진 구도 예시 이미지를 출력한다.
>                 * 시스템(벡엔드 서버)는 얼굴이 존재하면  DL_model2를 통해 얼굴 유형을 분석하고 AWS S3 버킷에 이미지를 저장한다.
>                 * 시스템(백엔드 서버)는 최종 결과값[“human”, “male_type”, “dsc”, “imgge(각 유형별 random 유명인 이미지)”]을 시스템(클라이언트)에 response한다.
> * 결과(뷰)
>     * 사용자 스토리
>         * 사용자는 선택한 이미지에 대한 결과를 확인한다.
>         * 사용자는 결과에 대한 지표 상세 설명을 확인한다.
>         * 사용자는 공유버튼을 눌러 결과이미지를 공유한다.
>             * 사용자는 공유버튼의 옵션 중 카카오톡/ 페이스북/ 인스타그램 버튼을 이용해서 공유이미지 링크를 확인하고 공유한다.
>         * 사용자는 이미지 저장 버튼을 눌러 결과를 저장한다.
>         * 사용자는 결과값이 만족스럽지 않은 경우 백버튼(메인으로 이동)을 눌러 메인뷰로 재진입한다.
>     * 시스템 스토리
>         * 시스템(클라이언트)은 시스템(백엔드서버)로 부터 반환받은 결과값을 정해진 protocol([“human”, “male_type”, “dsc”, “imgge(각 유형별 random 유명인 이미지)”])을 기반으로 rendering한다.
>         * 시스템(클라이언트)은 결과를 공유한다.
>             * 카카오톡 / 문자 / Facebook / instagram


---

<!-- SURVEY -->
## 사전 설문조사
**팀원들 각자의 외모에 대한 기준이 서로 상이함에 따라 외모 유형을 나누는데 어려움이 존재.<br>
설문조사를 통해 많은 의견이 확보되면 누구나 어느정도 납득이 가능한 대중화된 데이터를 얻을수 있을 것을 기대함.**<br>

<p align="center">
    <img src="test_img/pie_plot.png" height="400" width="400">
</p>
<p align="center">
    <img src="test_img/plot (1).png" height="400" width="500"><br>
    <strong>사전 설문조사 결과 순위</strong>
</p><br>

### 설문조사 기반의 데이터 분류 
> 설문결과 유형 분포에 110을 곱하면(조사 대상 유명인의 수) 각 유형별로 몇명의 유명인이 들어가는지 확인 할 수 있다.<br>
> 110 * 21.8 = 23.98 - Alpha <br>
> 110 * 21.4 = 23.54 - Beta <br>
> 110 * 22.5 = 24.75 - Gamma<br>
> 110 * 19.2 = 21.12 - Delta<br>
> 110 * 15.2 = 16.72 - Omega<br>
> 각각을 반올림해서 합하면 24 +24 + 25 + 21 +17 = 111이므로 소수점 첫째자리가 0.5로부터 가장 차이가 적은 Beta에서 1명을 뺀다.<br>
> 그러므로 설문조사 결과에는 Alpha : 24명, Beta : 23명, Gamma : 25명, Delta : 21명, Omega : 17명이 각각 분포한다고 판단 할 수 있다.<br>
> 외모 점수를 높게 받은 순(차은우, 원빈, ……, 국민의 힘 김재원, 오지헌)으로 Alpha부터 Omega까지 유형 분류 결과를 낼 수 있다.<br>


<p align="center">
    <img src="test_img/score_pie_plot.png" height="400" width=400"><br>
</p>

### 유형 분류 결과
> * Alpha : 차은우, 원빈, 현빈, 강동원, 뷔, 고수, 송강, 이동욱, 안정환 리즈, 서강준, 조인성, 정우성, 김수현, 공유, 박보검, 남주혁, 송중기, 송승헌, 임시완, 이종석, 정국, 장동건, 박형식
> * Beta : 정해인, 소지섭, 이병헌, 주지훈, 김희철, 차승원, 지성, 이승기, 강하늘, 유아인, 안재현, 조정석, 은지원, 민경훈, 유연석, 김우빈, 이정재, 차인표, 김래원, 오지호, 이선균, 하정우, 조규성, 송민호
> * Gamma : 침착맨, 지코, 조진웅, 황정민, 승리, 오정세, 류승룡, 이용진, 손흥민, 김종국, 류준열, 배우 김영철, 빅뱅 태양, 정우, 하하, 성시경, 송강호, 류승범, 기안84, 문재인, 윤도현, 유재석, 김동현, 이수근, 문상훈
> * Delta : 홍석천, 이준석, 유병재, 김풍, 강호동, 남창희, 유승민, 이진호, 마동석, 조세호, 피식대학 김민수, 주호민, 박지성, 윤석열, 이재명, 안철수, 장동민, 김범수, 이천수, 대성, 고창석
> * Omega : 홍구, 오메가 사피엔, 진중권, 천하람, 미키광수, 최욱, 곽튜브, 딕헌터, 오달수, 흑자헬스, 변희재, 래퍼 면도, 염따, 김제동, 정종철, 국민의 힘 김재원, 오지헌


<!-- BACK-END SERVER -->
## BACK-END SERVER

**Before building a DL server, build a backend server to develop protocols to send and receive with the Client.**

### Structuring FastAPI 

```bash
app
├── __init__.py
├── main.py
├── core
│   ├── models
│   │   ├── database.py
│   │   ├── models.py
│   │   └── __init__.py
│   └── schemas
│       ├── __init__.py
│       └── schema.py
└── v1
    ├── api.py
    ├── load.py
    ├── s3.py
    └── __init__.py 
```

> #### models
> * Import the same database session or object from v1
> #### schemas
> * My Pydantic models. Used for creating OpenAPI schemas since FastAPI is based on OpenAPI specification we use schemas everywhere, from Swagger generation to endpoint's expected request body.
> #### v1
> * used for creating OpenAPI schemas since FastAPI is based on OpenAPI specification we use schemas everywhere, from Swagger generation to endpoint's expected request body.

### API
**1. In the Client, enter the result value of any DL in the parameter and the remaining data in the request body as agreed with USER DATA.**<br>
**2. According to the parameter result value entered by the client, USER DATA is stored in the DB, and the client obtains the Response body value.**
```python
@router.post("/RegisterUserImg_sample")
async def RegisterUserImg_sample(first_user: first_user_tbl, Model_rst:int, result: last_result, db: Session = Depends(get_db)):
    c_first_user = models.Users()
    c_first_user.user_img = first_user.user_img
    c_first_user.age = first_user.age
    c_first_user.mbti = first_user.mbti

    Model_rst

    if Model_rst == 0 or Model_rst == 6:
        return result
    elif Model_rst >= 1 and Model_rst < 6:
        s3_url = handle_upload_img(first_user.user_img) # S3에 파일을 전송함과 동시에\ 주소 획득.
        Model_rst = Model_rst
        result.human = "True"
        type = conv_type(Model_rst)
        if Model_rst == 1:
            result.male_type = "Alpha"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "alpha").first().dsc_text
            ID = make_4_num(27, 36)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 2:
            result.male_type = "Beta"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "beta").first().dsc_text
            ID = make_4_num(37, 49)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 3:
            result.male_type = "Gamma"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "gamma").first().dsc_text
            ID = make_4_num(50, 62)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 4:
            result.male_type = "Delta"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "delta").first().dsc_text
            ID = make_4_num(63, 73)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 5:
            result.male_type = "Omega"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "omega").first().dsc_text
            ID = make_4_num(74, 84)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst, models.Male_IMG.id == ID[3]).first().url
        c_first_user.user_img_s3_url = s3_url
        c_first_user.cft_result = type
        c_first_user.created_at = datetime.now()
        c_first_user.created_by = "JSR"
        db.add(c_first_user)
        db.commit()

        return result
```

### CICD
**1. In the local reincarnation, the developer pushes to GitHub.** <br>
**2. GitHub Action is executed.** <br>
**3. GitHub Action pushes dcooker image to ECR according to yml file.** <br>
**4. GitHub Action performs ECS task definition according to the yml file.** <br>
**5. Distribute the server to ELB according to the configured service.**<br>
<p align="center">
    <img src="test_img/BACK-END_SERVER_CICD.PNG">
</p>

### Docker
**The image was built based on python 3.10. <br>
Packages that require installation were installed through requirements.**
```dockerfile
FROM python:3.10-alpine

WORKDIR /app

COPY ./requirements.txt /app/requirements.txt

RUN echo $PATH
RUN echo "export PATH=$PATH:/usr/local/bin/docker" >> ~/.bashrc
RUN cat ~/.bashrc
RUN echo $PATH

RUN pip install --no-cache-dir --upgrade -r /app/requirements.txt

COPY . /app/

CMD [ "uvicorn", "app.main:app", "--reload", "--workers", "1", "--host", "0.0.0.0", "--port", "80" ]

COPY ./ /app/
```


<!-- DL SERVER -->
## DL Server

**When the client calls the server's API, the result value is stored in the DB and S3 Bucket through DL MODEL learned and the response body is returned to the client.**

### API
**1. USER DATA sent by Client is entered.** <br>
**2. Return the result value through DL MODEL, which has learned USER IMG of USER DATA.**<br>
**3. Depending on the result value of DL MODEL, the response body is sent to the client according to the protocol set, and data is stored in DB and S3.**<br>

```python
@router.post("/RegisterResult")
async def RegisterResult(first_user: first_user_tbl, result: last_result, db: Session = Depends(get_db)):
    c_first_user = models.Users()
    c_first_user.user_img = first_user.user_img
    c_first_user.age = first_user.age
    c_first_user.mbti = first_user.mbti

    Model_rst = run(first_user.user_img)

    if Model_rst == 0 or Model_rst == 6:
        return result
    elif Model_rst >= 1 and Model_rst < 6:
        s3_url = handle_upload_img(first_user.user_img)  # S3에 파일을 전송함과 동시에\ 주소 획득.
        Model_rst = Model_rst
        result.human = "True"
        type = conv_type(Model_rst)
        if Model_rst == 1:
            result.male_type = "Alpha"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "alpha").first().dsc_text
            ID = make_4_num(27, 36)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 2:
            result.male_type = "Beta"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "beta").first().dsc_text
            ID = make_4_num(37, 49)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 3:
            result.male_type = "Gamma"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "gamma").first().dsc_text
            ID = make_4_num(50, 62)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 4:
            result.male_type = "Delta"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "delta").first().dsc_text
            ID = make_4_num(63, 73)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[3]).first().url
        elif Model_rst == 5:
            result.male_type = "Omega"
            result.dsc = db.query(models.Male).filter(models.Male.male_type == "omega").first().dsc_text
            ID = make_4_num(74, 84)
            result.img1 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[0]).first().url
            result.img2 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[1]).first().url
            result.img3 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[2]).first().url
            result.img4 = db.query(models.Male_IMG).filter(models.Male_IMG.male_id == Model_rst,
                                                           models.Male_IMG.id == ID[3]).first().url
        c_first_user.user_img_s3_url = s3_url
        c_first_user.cft_result = type
        c_first_user.created_at = datetime.now()
        c_first_user.created_by = "JSR"
        db.add(c_first_user)
        db.commit()

        return result
```

### CICD
**1-1. Push MODEL WEIGHT and deploy.sh files into the S3 bucket using AWS CLI in a local environment.**<br>
**1-2. Import the deploy.sh file of S3 bucket from EC2 to CLI.**<br>
**1-3. Push DL SERVER to GitHub in a local environment.**<br>
**2. GitHub Actions works.**<br>
**2-1. Upload the code to the S3 bucket according to the yml file created by GitHub Actions.**<br>
**3. Execute the SSM command of MODEL SERVER according to the yml file created by GitHub Actions.**<br>
**3-1. MODEL SERVER brings the MODEL WEIGHT of the bucket through the CLI.**<br>
**3-2. Construct the docker images.**<br>
**3-3. Run the docker container.**<br>
**4. If the container is already running, stop and run 3-2 through 3-3.**<br>
<p align="center">
    <img src="test_img/DL_SERVER_Diagram.PNG">
</p>

### Docker
**The image was built with Ubuntu-based python 3.10 version. <br>
Packages that require installation were installed through requirements.**


```dockerfile
FROM ubuntu:latest

WORKDIR /app

COPY ./requirements.txt /app/requirements.txt

# Install system dependencies
RUN apt-get update && apt-get install -y \
    python3.10 \
    python3.10-dev \
    python3-pip \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libglib2.0-0 \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev

RUN pip3 install opencv-python-headless

RUN pip install --no-cache-dir --upgrade -r /app/requirements.txt

COPY . /app/

CMD [ "uvicorn", "app.main:app", "--reload", "--workers", "1", "--host", "0.0.0.0", "--port", "80" ]

COPY ./ /app/
```

<!-- DATA BASE -->
## DataBase

**user_tbl** <br>
The table where the data entered by the USER will be stored.
> * user_img_s3 : Address of s3 where USER IMG will be stored.
> * user_img : USER IMG in base64 format.
> * cft_result : USER's classification results.
> * age : Date of birth of USER.
> * mbti : USER's MBTI. <br>

**male_tbl** <br>
The data table to be sent to the Client based on the results of the DL MODEL.
> * male_id : ID of the classification type.
> * male_type : Type classification value.
> * dsc_txt : Description values by type. <br>
 
**img_tbl** <br>
> * male_id : Type of image.
> * url : IMG by type stored in base64 format.


<p align="center">
    <img src="test_img/ERD.png">
</p>



<!-- DL -->
## DL

### 
<p align="center">
    <img src="test_img/model_result.png">
</p>

<!-- MOBILE -->